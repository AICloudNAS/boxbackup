How to build Box Backup for Windows (Native) on Linux using MinGW
By Chris Wilson, 2005-12-07

Install the MinGW cross-compiler for Windows:

- Debian users can "apt-get install mingw32"
- Fedora and SuSE users can download RPM packages from 
  [http://mirzam.it.vu.nl/mingw/]

You will need to know the prefix used by the cross-compiler executables.
It will usually be something like "ix86-mingw32*-". All the binaries in the
cross-compiler package will start with this prefix. The documentation below
assumes that it is "i386-mingw32-". Adjust to taste.

Download Zlib from [http://www.zlib.net/], unpack and enter source directory:

	export CC=i386-mingw32-gcc 
	export AR="i386-mingw32-ar rc" 
	export RANLIB="i386-mingw32-ranlib"
	./configure
	make
	make install prefix=/usr/local/i386-mingw32

Download OpenSSL 0.9.8b from 
[http://www.openssl.org/source/openssl-0.9.8b.tar.gz]

Unpack and configure:

	tar xzvf openssl-0.9.8b.tar.gz
	cd openssl-0.9.8b
	./Configure --prefix=/usr/local/i386-mingw32 mingw
	make makefile.one
	wget http://www.boxbackup.org/svn/box/chris/win32/support/openssl-0.9.8b-mingw-cross.patch
	patch -p1 < openssl-0.9.8b-mingw-cross.patch
	make -f makefile.one
	make -f makefile.one install

Download PCRE from 
[http://prdownloads.sourceforge.net/pcre/pcre-6.3.tar.bz2?download]

Unpack:

	tar xjvf pcre-6.3.tar.bz2
	cd pcre-6.3

Configure and make:

	export AR=i386-mingw32-ar
	./configure --host=i386-mingw32 --prefix=/usr/local/i386-mingw32/
	make winshared
	cp .libs/libpcreposix.a /usr/local/i386-pc-mingw32/lib
	cp pcreposix.h /usr/local/i386-pc-mingw32/include

Configure Box with:

	./configure --host=i386-mingw32 \
		CXXFLAGS="-mthreads -I/usr/local/i386-mingw32/include" \
		LDFLAGS=" -mthreads -L/usr/local/i386-mingw32/lib" \
		LIBS="-lcrypto -lws2_32 -lgdi32"
	make

or, if that fails, try this:

	export CXX="i386-mingw32-g++"
	export AR=i386-mingw32-ar
	export RANLIB=i386-mingw32-ranlib
	export CFLAGS="-mthreads"
	export CXXFLAGS="-mthreads"
	export LDFLAGS="-mthreads"
	export LIBS="-lcrypto -lws2_32 -lgdi32"
	(if you don't have a "configure" file, run "./bootstrap")
	./configure --target=i386-mingw32
	make CXX="$CXX" AR="$AR" RANLIB="$RANLIB" WINDRES="i386-mingw32-windres"
