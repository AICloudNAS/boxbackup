# https://circleci.com/docs/1.0/manually/

dependencies:
  cache_directories:
    - ~/.ccache

  pre:
    - sudo apt-add-repository -y ppa:george-edison55/cmake-3.x
    - sudo apt install -y ccache cmake cmake-data libboost-dev libdb-dev libreadline-dev libssl-dev libwww-perl time xsltproc zlib1g-dev

  override:
    # Build first, during the dependencies override phase, to allow results to be saved in the
    # ccache cache and persisted between runs:
    - env EXTRA_MAKE_ARGS=-j2 TEST_TARGET=release BUILD=cmake CC=gcc CXX=g++ TEST=n ./infrastructure/travis-build.sh

test:
  override:
    # The actual build should be done, so this should just run the tests:
    - env EXTRA_MAKE_ARGS=-j2 TEST_TARGET=release BUILD=cmake CC=gcc CXX=g++ ./infrastructure/travis-build.sh
